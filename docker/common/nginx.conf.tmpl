server {
    listen 443 ssl;
    server_name ${WEB_SERVER_NAME};
    client_max_body_size 128M;

    ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3;
    ssl_session_cache           shared:SSL:20m;
    ssl_session_timeout         10m;
    ssl_ciphers  "HIGH:!aNULL:!MD5:!kEDH";
    ssl_prefer_server_ciphers   on;

    location / {
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header X-Forwarded-Proto https;
        proxy_pass http://web_upstream;
        proxy_ssl_session_reuse off;
        proxy_set_header Host $http_host;
        proxy_redirect off;
    }

    #SSL
    ssl_certificate /etc/letsencrypt/cert/live/${WEB_SERVER_NAME}/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/cert/live/${WEB_SERVER_NAME}/privkey.pem;
}

upstream web_upstream {
  server web:3000;
}

server {
  listen 443 ssl;
  server_name ${ADMIN_SERVER_NAME};
  client_max_body_size 128M;
  root /app;
  index index.html;

  ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3;
  ssl_session_cache           shared:SSL:20m;
  ssl_session_timeout         10m;
  ssl_ciphers  "HIGH:!aNULL:!MD5:!kEDH";
  ssl_prefer_server_ciphers   on;

  location / {
    try_files $uri $uri/ /index.html;
  }

  #SSL
  ssl_certificate /etc/letsencrypt/cert/live/${ADMIN_SERVER_NAME}/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/cert/live/${ADMIN_SERVER_NAME}/privkey.pem;
}

server {
  listen 443 ssl;
  server_name ${API_SERVER_NAME};
  client_max_body_size 128M;

  ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3;
  ssl_session_cache           shared:SSL:20m;
  ssl_session_timeout         10m;
  ssl_ciphers  "HIGH:!aNULL:!MD5:!kEDH";
  ssl_prefer_server_ciphers   on;

  error_page 404 = @404;

  location / {
    proxy_set_header   Host             $host;
    proxy_set_header   X-Real-IP        $remote_addr;
    proxy_set_header   X-Host            $http_x_host;
    proxy_set_header   X-Server        $upstream_addr;
    proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
    proxy_redirect     off;
    proxy_connect_timeout 600s;
    proxy_read_timeout  600s;
    proxy_send_timeout  600s;
    proxy_buffers 1024 64k;
    proxy_ignore_client_abort on;

    proxy_pass http://backend:8080;
  }

  location @404 {
    default_type application/json;
    return 404 ' {"error": {"data": [], "status": 404, "message": "Route Not Found", "timestamp": null, "success": false}}';
  }

  #SSL
  ssl_certificate /etc/letsencrypt/cert/live/${API_SERVER_NAME}/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/cert/live/${API_SERVER_NAME}/privkey.pem;

}

server {
  listen 443 ssl;
  server_name ${STORAGE_SERVER_NAME};
  client_max_body_size 128M;

  ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3;
  ssl_session_cache           shared:SSL:20m;
  ssl_session_timeout         10m;
  ssl_ciphers  "HIGH:!aNULL:!MD5:!kEDH";
  ssl_prefer_server_ciphers   on;

  error_page 404 = @404;

  location / {
    proxy_set_header   Host             $host;
    proxy_set_header   X-Real-IP        $remote_addr;
    proxy_set_header   X-Host            $http_x_host;
    proxy_set_header   X-Server        $upstream_addr;
    proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
    proxy_redirect     off;
    proxy_connect_timeout 600s;
    proxy_read_timeout  600s;
    proxy_send_timeout  600s;
    proxy_buffers 1024 64k;
    proxy_ignore_client_abort on;

    proxy_pass http://minio:9000;
  }

  location @404 {
    default_type application/json;
    return 404 ' {"error": {"data": [], "status": 404, "message": "Route Not Found", "timestamp": null, "success": false}}';
  }

  #SSL
  ssl_certificate /etc/letsencrypt/cert/live/${STORAGE_SERVER_NAME}/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/cert/live/${STORAGE_SERVER_NAME}/privkey.pem;
}

server {
  listen 443 ssl;
  server_name ${STORAGE_WEB_PANEL_NAME};
  client_max_body_size 128M;

  ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3;
  ssl_session_cache           shared:SSL:20m;
  ssl_session_timeout         10m;
  ssl_ciphers  "HIGH:!aNULL:!MD5:!kEDH";
  ssl_prefer_server_ciphers   on;

  error_page 404 = @404;

  location / {
    proxy_set_header   Host             $host;
    proxy_set_header   X-Real-IP        $remote_addr;
    proxy_set_header   X-Host            $http_x_host;
    proxy_set_header   X-Server        $upstream_addr;
    proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
    proxy_redirect     off;
    proxy_connect_timeout 600s;
    proxy_read_timeout  600s;
    proxy_send_timeout  600s;
    proxy_buffers 1024 64k;
    proxy_ignore_client_abort on;

    proxy_pass http://minio:9001;
  }

  location @404 {
    default_type application/json;
    return 404 ' {"error": {"data": [], "status": 404, "message": "Route Not Found", "timestamp": null, "success": false}}';
  }

  #SSL
  ssl_certificate /etc/letsencrypt/cert/live/${STORAGE_WEB_PANEL_NAME}/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/cert/live/${STORAGE_WEB_PANEL_NAME}/privkey.pem;
}
